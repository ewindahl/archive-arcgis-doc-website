define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/event","Quoin/ListView","Quoin/Handlebars","dojo/query","dojo/dom-form","ApplicationManager/views/single","ApplicationManager/collections/applications","dojo/text!/templates/application-manager/list","dojo/NodeList-dom","ApplicationManager/helpers/handlebars"],function(e,t,n,r,i,s,o,u,a,f,l){var c=e([r],{events:{".searchForm submit":"searchApps",".searchBtn click":"searchApps",".searchClear click":"clearSearch","#application-search change":"resetList","#application-search keyup":"keyUp","#loadMore click":"loadMore"},templateString:f,loaded:!1,searching:!1,resetList:function(e){s(e.target).attr("value")[0]||this.sort()},clearSearch:function(){s("#application-search").attr("value",""),s(".searchClear").addClass("hide"),s(".application-list-search").addClass("hide"),this.sort(),this.toggleDefaultView()},keyUp:function(){s("#application-search").attr("value")[0]?s(".searchClear").removeClass("hide"):s(".searchClear").addClass("hide");var e=s("#application-search").attr("value");this.searchFilter(e),clearTimeout(this._searchDelay),this._searchDelay=setTimeout(t.hitch(this,this.searchApps),250)},searchFilter:function(e){this.filter(function(t){var n=t.get("description"),r=t.get("title"),i=n?n.match(e):!1,s=r?r.match(e):!1;return i||s||!1},{sort:[{attribute:"created",descending:!0}]})},searchApps:function(e){s(".application-list-default").addClass("hide");if(!this.searching){s(".searchBtn span.loading",this.domNode).removeClass("visuallyhidden"),s(".searchBtn span.icon-search",this.domNode).addClass("visuallyhidden"),this.searching=!0,this.searchFilter(n);var n=new RegExp(s("#application-search").attr("value"),"i");this.searchFilter(n),this.collection.fetch(n).then(t.hitch(this,function(){this.searchFilter(n),this.searching=!1,s(".searchBtn span.icon-search",this.domNode).removeClass("visuallyhidden"),s(".searchBtn span.loading",this.domNode).addClass("visuallyhidden"),this.activeItems()?s(".application-list-search").addClass("hide"):s(".application-list-search").removeClass("hide")},this))}},sort:function(){this.filter(function(e){return!0},{sort:[{attribute:"created",descending:!0}]})},loadMore:function(){this.collection.fetch(),s(this.loadMoreButton).text("Loading...").attr("disabled","")},toggleDefaultView:function(){this.collection.data.length?s(".application-list-default",h.domNode).addClass("hide"):!this.collection.data.length&&this.collection.loaded&&s(".application-list-default",h.domNode).removeClass("hide")}}),h=new c({collection:a,view:u});return h.subscribe("application:deleted",function(){this.toggleDefaultView()}),h.subscribe("application:created",function(){this.toggleDefaultView()}),h.subscribe("applications:loaded",function(){this.toggleDefaultView(),s(".application-list-loading",h.domNode).remove(),a.more()&&h.loadMoreButton?s(h.loadMoreButton).removeClass("hide").text("Load More").removeAttr("disabled"):s(h.loadMoreButton).remove()}),h});