define(["dojo/_base/declare","dijit/_WidgetBase","Quoin/Handlebars","Quoin/HandlebarsTemplated","Quoin/Model","dojo/query","dojo/_base/event","dojo/_base/lang","dojo/_base/array","dojox/lang/functional/object","dojo/on","dojo/dom-style","dojo/topic","dojo/dom-construct","dojo/NodeList-dom"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p){return n.registerHelper("get",function(e,t){return e.model?e.model.get(t):undefined}),n.registerHelper("log",function(e){console.log("Handlebars Log :",e)}),n.registerHelper("node",function(e){return"data-dojo-attach-point="+e}),e("Quoin.View",[t,r],{_bindings:{},_watches:[],constructor:function(e){if(!e||!e.model)this.model=new i({})},postCreate:function(){this._createEvents(),this._createBindings(),this.inherited(arguments)},destroy:function(){this._removeWatches(),this.inherited(arguments)},use:function(e){return this._removeWatches(),this.model=e,e&&(this._createBindings(),this._runBindings()),this},render:function(e,t,n){return n&&(this.destroyRendering(),this.buildRendering(),this._createEvents(),this._createBindings(),this._runBindings()),p.place(this.domNode,e,t),this},_createEvents:function(){f.forIn(this.events,u.hitch(this,function(e,t){var n=t.split(" "),r=n.splice(-1,1)[0],i=n.join(" "),a=s(i,this.domNode),f=u.hitch(this,function(t){o.stop(t),u.hitch(this,this[e])(t)});a.length?this.own(l(a,r,f)):this.own(l(this.domNode,i+":"+r,f))}))},_runBindings:function(){f.forIn(this.bindings,u.hitch(this,function(e,t){var n,r,i,o;u.isObject(e)&&(i=e.callback,o=e.element);if(u.isFunction(e)||i)n=i?u.hitch(this,i||e):u.hitch(this,e),n(this.model.get(t));if(u.isString(e)||o){var a=o?o.split(" "):e.split(" "),f=a.splice(-1,1)[0],l=a.join(" ");s(l,this.domNode).attr(f,this.model.get(t))}}))},_removeWatches:function(){a.forEach(this._watches,function(e){e.unwatch()})},_createBindings:function(){f.forIn(this.bindings,u.hitch(this,function(e,t){var n,r,i,o;u.isObject(e)&&(i=e.callback,o=e.element);if(u.isFunction(e)||i)n=i?u.hitch(this,i):u.hitch(this,e);if(u.isString(e)||o){var a=o?o.split(" "):e.split(" "),f=a.splice(-1,1)[0],l=a.join(" ");r=u.hitch(this,function(e){s(l,this.domNode).attr(f,e)})}var c=this.model.watch(t,u.hitch(this,function(e,t,i){r&&r(i),n&&n(i)}));this._watches.push(c)}))},subscribe:function(e,t){return this.own(h.subscribe(e,u.hitch(this,t)))},publish:function(){var e=Array.prototype.slice.call(arguments);h.publish.apply(this,e)}})});