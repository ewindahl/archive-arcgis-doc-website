define(["dojo/_base/declare","dojo/_base/lang","dojox/lang/functional/object","dojo/Evented","dojo/topic","Quoin/History","Quoin/Base"],function(e,t,n,r,i,s,o){var u=/\((.*?)\)/g,a=/(\(\?)?:\w+/g,f=/\*\w+/g,l=/[\-{}\[\]+?.,\\\^$|#\s]/g,c=e("Quoin.Router",[r,o],{route:function(e,n,r){return e instanceof RegExp||(e=this._routeToRegExp(e)),s.route(e,t.hitch(this,function(t){var i=this._extractParameters(e,t),o={name:n,args:i};r&&r.apply(this,i),this.emit("route:"+n,o),this.emit("route",o),s.emit("route",o)})),this},navigate:function(e,t){return s.navigate(e,t),this},_bindRoutes:function(){if(!this.routes)return;var e,t=n.keys(this.routes);while((e=t.pop())!==null)this.route(e,this.routes[e])},_routeToRegExp:function(e){return e=e.replace(l,"\\$&").replace(u,"(?:$1)?").replace(a,function(e,t){return t?e:"([^/]+)"}).replace(f,"(.*?)"),new RegExp("^"+e+"$")},_extractParameters:function(e,t){return e.exec(t).slice(1)}});return new c});