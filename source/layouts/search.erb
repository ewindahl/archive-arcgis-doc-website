<!doctype html>
<!--[if lt IE 7]>      <html class="lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="lt-ie9 ie8"> <![endif]-->
<!--[if IE 9]>         <html class="ie ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html> <!--<![endif]-->
  <head>
    <meta charset="utf-8">

    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">

    <title><%= data.page.title ? data.page.title + " | ArcGIS" : "ArcGIS" %></title>

    <script>
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-215788-63']);
      _gaq.push(['_setDomainName', 'arcgis.com']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

    </script>

    <!--[if lt IE 9]>
      <%= javascript_include_tag "libs/html5shiv.js" %>
      <%= javascript_include_tag "libs/selectivizr-min.js" %>
      <style>
        #wrapper {
          min-width: 960px;
        }
      </style>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="http://fast.fonts.com/cssapi/4a60d16b-c9e4-404d-89d3-809adb97d65c.css"/>
    <link rel="shortcut icon" href="/img/favicon.ico">

    <%= stylesheet_link_tag "screen" %>
    <% if current_page.data.css %>
      <% current_page.data.css.each do |stylesheet| %>
        <%= stylesheet_link_tag stylesheet, { :media=> "all" } %>
      <% end %>
    <% end %>

  <%= javascript_include_tag "sitecfg" %>

   <%= javascript_include_tag "locale/l10NStrings" %>

    <%= javascript_include_tag "libs/jquery-1.9.1.min" %>

  <%= javascript_include_tag "signIn" %>

    <% if current_page.data.js %>
      <% current_page.data.js.each do |javascript| %>
        <%= javascript_include_tag javascript %>
      <% end %>
    <% end %>
    <% if current_page.data.mobile %>
      <meta name="viewport" content="width=device-width,initial-scale=1">
    <% else %>
      <style>
        body {
          min-width: 768px;
        }
      </style>
    <% end%>

	<!--- search MD -->
	<% if current_page.data.metatags %>
      <% current_page.data.metatags.each do |v| %>
        <%= v %>
      <% end %>
    <% end %>

  </head>
  <body class="<%= current_language %>" >
    <div id="wrapper">
      <div id="page">

      <header data-skin="app" id="header">
        <div class="container relative-container">
          <div class="header-inner <% if current_page.data.mobile %>responsive<% end %>">

            <div class="logo-wrap">
              <a href="/" id="site-logo">Arc<span>GIS</span></a>
              <span class="down-arrow" id="down-arrow"></span>
            </div>

            <%= partial "_partial/site_header_dropdown" %>
            <nav>
              <%= partial "_partial/site_header_nav" %>
            </nav>
            
            <%= link_to "Esri", "http://www.esri.com", id: "esri-logo" %>

<!--            
            <div id="lg-container" class="dropdown-navigation">
              <div id="lang-block"></div>
            </div>
   -->         

<!--
              <div id="lg-container" class="banner-navigation">

              <div class="dropdown-navigation no-top">
              </div>

              <div id="logged-out-navigation" class="dropdown-navigation no-top">
                  <a data-langlabel="sign-in" id="login-link" class="btn user-signin" href="#"><span class="profile-icon"></span>Sign In</a>
              </div>

              <div id="logged-in-navigation" class="dropdown-navigation no-top dropdown-wrapper hide">
                  <a id="A1" class="dropdown btn user-signin" href="#">user</a>
                  <div class="dropdown-content">
                      <div class="dropdown-menu">
                          <ul class="myconsole">
                              <li><a id="agolProfile" href="http://www.arcgis.com/home/user.html">My Profile</a></li>
                          </ul>
                          <hr class="myconsole" />
                          <ul class="myconsole">
                              <li><a id="agolHelp" href="http://www.arcgis.com/home/support.html">Help</a></li>
                          </ul>
                          <hr class="myconsole" />
                          <ul>
                              <li><a id="agolLogout" href="#">Sign Out</a></li>
                          </ul>
                      </div>
                  </div>
              </div>

              <div id="lang-block"></div>

          </div>
-->

            <div id="mobile-navigation" class="dropdown-navigation dropdown-wrapper">
              <a href="#" class="dropdown btn small light icon icon-list-2"><%= t("site.nav.select") %></a>
              <div class="dropdown-content">
                <div class="dropdown-menu">
                  <%= partial "_partial/site_header_nav" %>
                </div>
              </div>
            </div>
            
          </div>
        </div>
      </header>
      <div data-skin="app" class="fadein section-bar blue">
        <div class="container search">
          <header>
            <h1 data-langlabel="search">Search</h1>
          </header>
          <!--
          <nav>&nbsp;</nav>
          -->

        </div>
      </div>

      <header data-skin="marketplace" id="header">
          <div class="container relative-container">
              <div class="header-inner <% if current_page.data.mobile %>responsive<% end %>">

                <div class="logo-wrap">
                  <a id="site-logo" href="http://marketplace.arcgis.com/" data-langlabel="arcgis-logo-text">Arc<span>GIS</span> Marketplace</a>
                  <span class="down-arrow" id="down-arrow"></span>
                </div>
                
                <%= partial "_partial/site_header_dropdown" %>
                <nav>
                </nav>
                
                <form id="mkpSearchForm" action="#">
                  <input type="search" name="mkpSearch"  placeholder="<%= t("site.nav.mpSearch") %>">
                </form>


                <a href="http://www.esri.com/" id="esri-logo">Esri</a>

                <!--<div id="lg-container" class="dropdown-navigation">
                  <div id="lang-block"></div>
               </div> -->

<!--
              <div id="logged-out-navigation" class="dropdown-navigation">
                <a data-langlabel="sign-in" id="login-link" class="btn marketplace" href="#">
                  <span class="profile-icon"><%= t("site.nav.sign_in") %></a>
              </div>

              <div id="logged-in-navigation" class="dropdown-navigation dropdown-wrapper hide">
                <a id="login-link" class="dropdown btn marketplace" href="#"><%= t("site.nav.sign_in_user") %></a>
                <div class="dropdown-content">
                  <div class="dropdown-menu">
                    <ul class="myconsole">
                      <li><a href="#"><%= t("site.nav.sign_in_myconsole") %></a></li>
                    </ul>
                    <hr class="myconsole" />
                    <ul>
                      <li><a href="#"><%= t("site.nav.sign_in_logout") %></a></li>
                    </ul>
                  </div>
                </div>
              </div>
-->
              <nav class="right-nav">
                 <ul>

                    <li><a href="<%= t("paths.mphelp") %>"><span class="help-icon"></span><%= t("site.nav.help") %></a></li>
                 </ul>
              </nav>

              </div>
          </div>
      </header>
      <div data-skin="marketplace" class="fadein section-bar marketplace">
        <div class="container search">
          <header>
            <h1 data-langlabel="search">Search</h1>
          </header>
          <!--
          <nav>&nbsp;</nav>
          -->
        </div>
      </div>


      <%= yield %>

      </div>
    </div>
  

    <footer data-skin="app" id="footer">
      <div class="container">
        <div class="row">
          <nav>
            <h4>ArcGIS</h4>
            <%= partial "_partial/site_header_nav" %>
          </nav>
          <%= partial "_partial/site_footer_common" %>
        </div>
      </div>
    </footer>

    <footer data-skin="marketplace" id="footer" class="">
      <div class="container">
        <div class="row">
          <nav>
            <h4 data-langlabel="arcgis-marketplace">ArcGIS Marketplace</h4>
            <ul>
               <li><a data-langlabel="home" href="http://marketplace.arcgis.com"><%= t("site.nav.home") %></a></li>
               <li class="myconsole"><a data-langlabel="my-console" href="http://marketplace.arcgis.com/console.html"><%= t("site.nav.sign_in_myconsole") %></a></li>
              <li><a data-langlabel="help" href="<%= t("paths.mphelp") %>"><%= t("site.nav.help") %></a></li>

            </ul>
          </nav>

          <%= partial "_partial/site_footer_common" %>
        </div>
      </div>
    </footer>
  </body>




  <!-- set dropdown/show home in footer -->
  <script>
$(document).ready(function(){
  var winloc = window.location,
      query = winloc.search,
      mkpFlg = query && query.indexOf ("product=marketplace") >=0;

  if (mkpFlg) {
    $("*[data-skin='app']").remove();
    $("body").addClass ("marketplace");

    $($("#dropDown a").get (3)).addClass ("current selected");

  } else {
    $("*[data-skin='marketplace']").remove();

    $($("#dropDown a").get (0)).addClass ("current selected");
    $("#footer .home").toggleClass("hide");
  }

  /* copy from drop-down.js */
  /* cann't include drop-down.js because duplicate ID/execution order problem */
  function dropDownHandler() {

    function addEvent(element, event, funct){
      if (element.addEventListener){
       return element.addEventListener(event, funct, false);
      } else {
       return element.attachEvent('on'+event, funct);
      }
    }

    var downArrow = document.getElementById('down-arrow');
    var body      = document.getElementsByTagName("body")[0];
    var dropDown  = document.getElementById('dropDown');

    addEvent(body, 'click', function(e){
      if (e.target == downArrow && dropDown.className !== 'visible') {
        dropDown.className = 'visible';
      } else {
        dropDown.className = '';
      }
    });
  }

  dropDownHandler();

});


$(document).ready(function() {
  
  dbg ("doc.ready");

  app.util.changeL10NLabel ();

  app.router = new app.SearchRouter();
  
  app.qStmt = new app.QueryStatement;
  app.qResult = new app.QueryResult;
  
  app.searchBox = new app.SearchBoxView ({model:app.qStmt, el: $("#searchBox")});
  app.searchFilter = new app.SearchFilterView ({model:app.qStmt, el: $("#searchFilter")});
  app.searchLang = new app.SearchLangView ({model:app.qStmt, el: $("#searchLang")});

  app.srPager = new app.SRPagerView ({model: app.qResult, el: $("#searchPager")});
  app.srStat = new app.SRStatView ({model: app.qResult, el: $("#searchStat")});
  app.srList = new app.SRListView ({model: app.qResult, el: $("#searchResult")});
  
  // Forum Panel related
  if(sitecfg["includeForumResult"]){
	  app.fqResult = new app.FQueryResult;
	  app.forumList = new app.ForumListView ({model: app.fqResult, el: $("#forumResult")});
  }
  $("#moreForumResult").bind("click", function () {
	$("#searchFilter li a").each(function () {
		if($(this).attr("data-fval") == "discussions"){
			$(this).trigger("click");
		}
	});
  });
  // End of Forum Panel related code
  
  Backbone.history.start({pushState: true, root: "/search/"});

});


  </script>

</html>
