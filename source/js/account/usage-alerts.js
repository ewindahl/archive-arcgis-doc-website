require(["Config","SessionManager","Notifications","dojo/query","dojo/dom-construct"],function(e,t,n,r,i){function o(){esri.request({url:e.billing+"/subscription/preferences/notifications",content:{token:t.token(),f:"json"}}).then(function(e){e.code=="200"?(s.notifications=e.notification,a()):u()},function(e){u()})}function u(){r("#alertsWrapper").addClass("error-message"),r("#loading-message").addClass("hide"),r("#error-message").removeClass("hide")}function a(){var e,t;s.notifications.forEach(function(n){e=i.create("li",{},"notification-list"),t=i.create("label",{innerHTML:n.description},e),notificationInput=i.create("input",{type:"checkbox",checked:n.status,name:"notifications",id:"notification-"+n.item,value:"notification-"+n.item,disabled:n.readOnly},t,"before")}),r("#loading-message").addClass("hide"),r("#content-wrapper").removeClass("hide")}function f(){var n;s.notifications.forEach(function(e){n=r("input[value=notification-"+e.item+"]"),n.length==1&&(e.status=n[0].checked)}),esri.request({url:e.billing+"/subscription/preferences/notifications",content:{notification:JSON.stringify(s.notifications),token:t.token(),f:"json"}},{usePost:!0}).then(function(e){e.code=="200"?l(r("#notifications"),"success","Alert preferences successfully updated"):l(r("#notifications"))},function(e){l(r("#notifications"),"error")})}function l(e,t,i){t=t||"error",i=i||"We were unable to complete your request at this time.",e.empty();var s=new n(e);s[t](i),r("#submitBtn").attr("disabled",!1)}t.queue(o);var s={notifications:[]};r("#notifications-form").on("submit",function(e){e.preventDefault(),e.stopImmediatePropagation(),r("#submitBtn").attr("disabled",!0),r("#notifications").empty(),f()})});