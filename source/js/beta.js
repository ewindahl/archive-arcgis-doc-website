require(["Config","Notifications","dojo/query","dojo/dom-form","dojo/dom-construct","dojo/ready"],function(e,t,n,r,i,s){function f(){esri.request({url:e.billing+"/survey/platforms/",content:{f:"json"},handleAs:"json"}).then(function(e){if(e.code==200){n("#loading-message").addClass("hide"),n("#trial-wrapper").removeClass("hide");for(var t=0;t<e.platforms.length;t++)i.create("label",{innerHTML:'<input type="checkbox" name="platforms" value="'+e.platforms[t]+'" /> '+e.platforms[t]},"survey")}else n("#loading-message").addClass("hide"),n("#error-message").removeClass("hide"),n("#trial-wrapper").addClass("hide")},function(e){n("#loading-message").addClass("hide"),n("#error-message").removeClass("hide"),n("#trial-wrapper").addClass("hide")})}function l(){esri.request({url:e.billing+"/p/sellableCountry",content:{f:"json"},handleAs:"json"}).then(function(e){e.code==200?e.sellable===!0?f():(n("#loading-message").addClass("hide"),n("#unavailable-message").removeClass("hide")):(n("#loading-message").addClass("hide"),n("#error-message").removeClass("hide"))},function(e){n("#loading-message").addClass("hide"),n("#error-message").removeClass("hide")})}function c(){n("#submitBtn").attr("disabled",!1).attr("value","Join the ArcGIS for Developers Beta")}function h(e){var t=!0;return n(".error-message").remove(),n(".error").removeClass("error"),e.firstName||(t=!1,n("input[name='firstName']").addClass("error")),e.lastName||(t=!1,n("input[name='lastName']").addClass("error")),e.email?e.email.match(o)&&(t=!1,a.clear(),a.error(u)):(t=!1,n("input[name='email']").addClass("error")),e.reason||(t=!1,n("textarea[name='reason']").addClass("error")),t}function p(t){n("#submitBtn").attr("disabled",!0).attr("value","Submitting..."),t.f="json",typeof t.platforms=="undefined"?t.platforms="":typeof t.platforms!="string"&&(t.platforms=t.platforms.join(",")),esri.request({url:e.billing+"/beta",content:t,handleAs:"json"},{usePost:!0}).then(function(e){e&&e.hasOwnProperty("status")&&e.status.toLowerCase()=="success"?(n("#trial-wrapper").addClass("hide"),n("#success-message").removeClass("hide"),n("#email-address").html(n("input[name='email']").attr("value")[0])):e.code==406?d("The email provided has already been used in a beta request."):d()},function(e){d()})}function d(e){i.create("div",{"class":"error-message",innerHTML:typeof e!="undefined"?e:"We were unable to complete your request at this time."},"trial-form","before"),n("#submitBtn").attr("disabled",!1).attr("value","Join the ArcGIS for Developers Beta")}var o=/.gov$/i,u="Due to <a class='error-anchor' target='_blank' href='http://csrc.nist.gov/groups/SMA/fisma/index.html'>FISMA</a> compliance standards, the ArcGIS for Developers sign-up <br /> does not currently support federal entities. <br /> Please visit <a class='error-anchor' href='http://arcgis.com'>http://arcgis.com</a> to set up an account.",a="";s(function(){a=new t(n("#emailNotifications")),c(),l()}),n("input[name='email']").on("change",function(e){var t=n(e.target).val();t.match(o)?(a.clear(),a.error(u)):a.clear()}),n("#trial-form").on("submit",function(e){e.preventDefault(),e.stopImmediatePropagation();var t=r.toObject("trial-form");if(!h(t))return;p(t)})});